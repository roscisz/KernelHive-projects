import os, sys
import struct
import StringIO

sys.path.append('../../src/dev-util/')
#from mongoDBWrapper import MongoDBWrapper

msrmnts = [	
	((54,21,12), (18,38,7), 33.21, 31.64, 26.32, 22.48, 36.36, 27.03, 26.34, 31.72, 32.86, 29.84, 32.69, 36.06, 36.04, 43.07, 44.08, 44.08, 38.60, 41.97, 25.14, 48.35, 23.88, 28.03, 23.85, 25.04, 13.80, 22.33),
	((54,22,4), (18,42,4), 30.07, 23.35, 24.60, 18.39, 23.35, 22.69, 23.29, 37.81, 30.85, 39.31, 29.18, 27.85, 50.93, 36.58, 42.18, 28.91, 24.56, 37.04, 27.46, 22.90, 22.26, 36.81, 27.90, 22.44, 23.36, 25.87),
	((54,24,3), (18,39,27), 30.61, 31.69, 27.86, 19.87, 27.70, 22.88, 23.65, 23.56, 18.66, 13.84, 13.24, 37.19, 19.98, 22.03, 26.24, 21.42, 14.54, 21.77, 16.16, 8.87, 10.66, 29.10, 25.94, 38.56, 6, 14.97),
	((54,33,39), (18,29,36), 17.41, 21.92, 18.80, 17.93, 19.15, 20.20, 11.36, 22.77, 9.76, 10.77, 10.93, 10.87, 7.74, 8.32, 9.37, 9.37, 6.58, 14.29, 6.96, 9.98, 20.20, 12.85, 11.72, 12.64, 11.33, 18,94),
	((54,19,42), (18,33,28), 17.45, 15.30, 14.90, 12.33, 18.59, 18.17, 17.03, 17.05, 18.91, 20.93, 25.03, 24.25, 23.04, 21.09, 20.66, 17.98, 18.56, 17.57, 11.49, 19.13, 13.03, 26.32, 40.38, 24.67, 9.27, 14.51),
	((54,25,54), (18,34,47), 26.77, 24.56, 21.23, 16.92, 22.76, 17.68, 20.49, 22.50, 20.14, 16.25, 15.99, 16.69, 16.58, 18.70, 17.20, 15.05, 9.97, 13.30, 11.32, 14.89, 8.38, 17.24, 12.83, 24.29, 5.63, 14.76),
	# Tczew na razie nie
	#((54,05,9), (18,47,15), 22),
	((54,22,49), (18,37,13), 52.48, 55.65, 48.22, 29.93, 37.94, 34.05, 32.22, 34.10, 33.41, 29.22, 33.83, 23.57, 20.36, 26.54, 36.60, 39.68, 25.51, 31.60, 21.19, 25.08, 25.68, 21.76, 28.19, 28.32, 24.04, 31.64),
	((54,27,56), (18,27,53), 22.13, 16.59, 15.74, 18.94, 18.46, 19.97, 19.00, 24.95, 22.51, 23.08, 22.47, 26.39, 20.31, 19.04, 23.74, 18.05, 16.71, 20.97, 13.85, 19.62, 10.44, 21.35, 17.73, 22.26, 5.20, 14.43),
	((54,31,31), (18,32,11), 36.14, 28.53, 25.31, 32.07, 38.11, 33.38, 29.81, 37.37, 20.79, 23.57, 21.79, 27.24, 30.62, 27.71, 26.96, 27.07, 28.45, 25.43, 27.86, 34.57, 27.67, 26.74, 47.44, 51.20, 14.14, 28.81)
]

ul = ((54,37,30), (18,22,04))
br = ((54,19,02), (18,45,16))

def tuple_to_dgrs(tup):
	return tup[0] + tup[1] / 60.0 + tup[2] / 3600.0


if __name__ == '__main__':

    bmpWidth = 10
    bmpHeight = 10

    ulLat = tuple_to_dgrs(ul[0])
    ulLon = tuple_to_dgrs(ul[1])
    brLat = tuple_to_dgrs(br[0])
    brLon = tuple_to_dgrs(br[1])

    dLat = brLat - ulLat
    dLon = brLon - ulLon

    latPerPx = dLat / bmpHeight
    lonPerPx = dLon / bmpWidth

    output = StringIO.StringIO()

    output.write(struct.pack('iiiffff', bmpWidth, bmpHeight, len(msrmnts), ulLat, ulLon, latPerPx, lonPerPx))

    hour = 0

    for msrmnt in msrmnts:
	output.write(struct.pack('fff', tuple_to_dgrs(msrmnt[0]), tuple_to_dgrs(msrmnt[1]),  msrmnt[2 + hour]))

    dbout = False

    if dbout:
    	db = MongoDBWrapper('des01')
    	id = db.allocate()
	db.put(output.getvalue(), id)
    	print id
    else:
	print output.getvalue()
